const functions = require('firebase-functions');
const admin = require('firebase-admin');

module.exports = functions.pubsub
  .schedule('0 8 * * *') // Runs every day at 8 AM
  .timeZone('America/Los_Angeles')
  .onRun(async (context) => {
    const db = admin.firestore();
    const today = new Date();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');

    // Check 'employees' collection for matching birthdays
    const snapshot = await db
      .collection('employees')
      .where('birthdayMonth', '==', mm)
      .where('birthdayDay', '==', dd)
      .get();

    if (!snapshot.empty) {
      snapshot.forEach(async (doc) => {
        const employeeData = doc.data();
        // Use your email/SMS/Slack API logic
        console.log(`Sending birthday notification to ${employeeData.name}`);
      });
    }
    return null;
  });
